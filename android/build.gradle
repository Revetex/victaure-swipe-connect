buildscript {
    repositories {
        google()
        mavenCentral()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:8.7.3'
        classpath 'com.google.gms:google-services:4.4.0'
    }
}

apply from: "variables.gradle"

allprojects {
    repositories {
        google()
        mavenCentral()
    }
}

tasks.register('clean', Delete) {
    delete rootProject.buildDir
    // Add error handling and retry mechanism for directory deletion
    doFirst {
        def maxRetries = 3
        def retryCount = 0
        def success = false
        
        while (!success && retryCount < maxRetries) {
            try {
                project.buildDir.deleteDir()
                success = true
            } catch (Exception e) {
                retryCount++
                if (retryCount == maxRetries) {
                    logger.warn("Failed to delete directory after $maxRetries attempts: ${e.message}")
                } else {
                    Thread.sleep(1000) // Wait 1 second before retry
                }
            }
        }
    }
}

// Ensure Java 17 compatibility
allprojects {
    tasks.withType(JavaCompile) {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }
}